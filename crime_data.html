<!DOCTYPE html>
<html>
<head>
<script src="d3.min.js"></script>
<link rel='stylesheet' href='style.css'/>
<title>Crime Data</title>
</head>
<body>
        <div class='chart'>
            <h1>Normal Horizontal Graphs - Thefts</h1>
            <div class='chart1'></div>
        </div>

        <div class='chart'>
            <h1>Horizontal SVG Graphs - Thefts</h1>
            <div class='chart2'></div>
        </div>

        <div class='chart'>
            <h1>Vertical SVG Graphs - Thefts</h1>
            <div class='chart3'></div>
        </div>

        <div class='chart'>
            <h1>Vertical SVG Graphs with Axes - Thefts</h1>
            <svg class='chart4'></svg>
        </div>

        <div class='chart'>
            <h1>Vertical SVG Graphs with Axes - Assaults</h1>
            <svg class='chart5'></svg>
        </div>

        <div class='chart'>
            <h1>Vertical SVG Graphs with Axes - Thefts valuing over 500$</h1>
            <svg class='chart6'></svg>
        </div>

        <div class='chart'>
            <h1>Vertical SVG Graphs with Axes - Thefts valuing under 500$</h1>
            <svg class='chart7'></svg>
        </div>

        <div class='chart'>
            <h1>Vertical SVG Graphs with Axes - Assaults resulting in arrests</h1>
            <svg class='chart8'></svg>
        </div>

        <div class='chart'>
            <h1>Vertical SVG Graphs with Axes - Assaults not resulting in arrests</h1>
            <svg class='chart9'></svg>
        </div>

        <div class='chart'>
            <h1>Stacked SVG Charts - Thefts</h1>
            <svg class='chart10'></svg>
        </div>
    <script>

        var count = function(data, check) {
            var counter = 0;
            data.forEach(function(d) {
                counter += check(d);
            });
            return counter;
        };

        var sortFunc = function(data, parameter, desc) {
            return data.sort(function(d, e) {
                if(desc) {
                    if(parameter)
                    return e[parameter] - d[parameter];
                    return e - d;
                } else {
                    if(parameter)
                    return d[parameter] - d[parameter];
                    return d - e;
                }
            });
        };


        d3.json('crime_data.json', function(error, data) {

            var dataArray = [];
            var xScale = d3.scale.linear().domain([0, 100000]).range([0, 500]);
            var data = data['data'];

            data.forEach(function(d) {
                if (dataArray.indexOf(d.y) == -1) dataArray.push(d.y);
            });

            dataArray = sortFunc(dataArray, null, false);

            var theftCount = function(d) {
                return count(data, function(data) {
                    return (data['t'] == 'THEFT' && data['y'] == d)? true : false;
                });
            };

            var assaultCount = function(d) {
                return count(data, function(data) {
                    return (data['t'] == 'ASSAULT' && data['y'] == d)? true : false;
                });
            };

            var theftOver500Count = function(d) {
                return count(data, function(data) {
                    return (data['t'] == 'THEFT' && data['y'] == d && data['v'] == 'OVER $500')? true : false;
                });
            };

            var theftUnder500Count = function(d) {
                return count(data, function(data) {
                    return (data['t'] == 'THEFT' && data['y'] == d && data['v'] == '$500 AND UNDER')? true : false;
                });
            };

            var assaultArrestCount = function(d) {
                return count(data, function(data) {
                    return (data['t'] == 'ASSAULT' && data['y'] == d && data['a'] == 'true')? true : false;
                });
            };

            var assaultNotArrestCount = function(d) {
                return count(data, function(data) {
                    return (data['t'] == 'ASSAULT' && data['y'] == d && data['a'] == 'false')? true : false;
                });
            };

            /***********************************/

            d3.select('.chart1')
                .selectAll("div")
                .data(dataArray)
                .enter()
                .append("div")
                .attr('class', 'bar')
                .style('width', function(d) { return xScale(theftCount(d))+'px'; })
                .text( function(d) { return theftCount(d) });

            /***********************************/

            var w = 500;
            var h = 500;

            var svg = d3.select('.chart2')
                .append('svg')
                .attr('width', w)
                .attr('height', h);

            dy = h/dataArray.length;

            var bars = svg.selectAll(".bar")
        		.data(dataArray)
        		.enter()
        		.append("rect")
        		.attr("y", function(d, i) {return dy*i;})
        		.attr("x", function(d, i) {return 0;})
        		.attr("width", function(d) { return xScale(theftCount(d))+'px'; })
        		.attr("height", function(d) { return '25px'; });

            /***********************************/

            var svg = d3.select('.chart3')
                .append('svg')
                .attr('width', w)
                .attr('height', h);

            dx = w/dataArray.length;

            var bars = svg.selectAll(".bar")
        		.data(dataArray)
        		.enter()
        		.append("rect")
        		.attr("x", function(d, i) {return dx*i;})
        		.attr("y", function(d, i) {return h-xScale(theftCount(d));})
        		.attr("width", dx-4)
        		.attr("height", function(d) { return xScale(theftCount(d))+'px'; });

            /***********************************/

            var margin = {top: 20, right: 30, bottom: 30, left: 50},
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
            var y = d3.scale.linear().range([height, 0]);

            x.domain(dataArray);
            y.domain([0, 100000]);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left");

            /****/

            var chart = d3.select("svg.chart4")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            chart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            chart.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Thefts");


            chart.selectAll(".barRect")
                .data(dataArray)
                .enter().append("rect")
                .attr("class", "barRect")
                .attr("x", function(d) { return x(d); })
                .attr("y", function(d) { return y(theftCount(d)); })
                .attr("height", function(d) { return height - y(theftCount(d)); })
                .attr("width", x.rangeBand());

            /****/

            var chart = d3.select("svg.chart5")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            chart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            chart.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Assaults");

            chart.selectAll(".barRect")
                .data(dataArray)
                .enter().append("rect")
                .attr("class", "barRect")
                .attr("x", function(d) { return x(d); })
                .attr("y", function(d) { return y(assaultCount(d)); })
                .attr("height", function(d) { return height - y(assaultCount(d)); })
                .attr("width", x.rangeBand());

            /****/

            var chart = d3.select("svg.chart6")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            chart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            chart.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Theft valuing over $500");

            chart.selectAll(".barRect")
                .data(dataArray)
                .enter().append("rect")
                .attr("class", "barRect")
                .attr("x", function(d) { return x(d); })
                .attr("y", function(d) { return y(theftOver500Count(d)); })
                .attr("height", function(d) { return height - y(theftOver500Count(d)); })
                .attr("width", x.rangeBand());

            /****/

            var chart = d3.select("svg.chart7")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            chart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            chart.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Theft valuing under $500");

            chart.selectAll(".barRect")
                .data(dataArray)
                .enter().append("rect")
                .attr("class", "barRect")
                .attr("x", function(d) { return x(d); })
                .attr("y", function(d) { return y(theftUnder500Count(d)); })
                .attr("height", function(d) { return height - y(theftUnder500Count(d)); })
                .attr("width", x.rangeBand());

            /****/

            var chart = d3.select("svg.chart8")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            chart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            chart.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Assaults resulting in arrests");

            chart.selectAll(".barRect")
                .data(dataArray)
                .enter().append("rect")
                .attr("class", "barRect")
                .attr("x", function(d) { return x(d); })
                .attr("y", function(d) { return y(assaultArrestCount(d)); })
                .attr("height", function(d) { return height - y(assaultArrestCount(d)); })
                .attr("width", x.rangeBand());

            /****/

            var chart = d3.select("svg.chart9")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            chart.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            chart.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Assaults not resulting in arrests");

            chart.selectAll(".barRect")
                .data(dataArray)
                .enter().append("rect")
                .attr("class", "barRect")
                .attr("x", function(d) { return x(d); })
                .attr("y", function(d) { return y(assaultNotArrestCount(d)); })
                .attr("height", function(d) { return height - y(assaultNotArrestCount(d)); })
                .attr("width", x.rangeBand());

            /****/

            var newData = [];

            var margin = {top: 20, right: 20, bottom: 30, left: 40},
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

                dataArray.forEach(function(d) {
                    var a = {};
                    a.year = d,
                    a.types = [
                        {y : 100000 - theftOver500Count(d),
                         height : theftOver500Count(d)},
                        {y : 100000 - theftUnder500Count(d) - theftOver500Count(d),
                         height : theftUnder500Count(d)}
                    ];
                    newData.push(a);
                });

            var x = d3.scale.ordinal().rangeRoundBands([0, width], .1);
            var y = d3.scale.linear().rangeRound([0, height]);

            var color = d3.scale.ordinal().range(["#98abc5", "#8a89a6"]);

            var xAxis = d3.svg.axis()
                .scale(x)
                .orient("bottom");

            var yAxis = d3.svg.axis()
                .scale(y)
                .orient("left")
                .tickFormat(d3.format(".2s"));

            var svg = d3.select("svg.chart10")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

              color.domain(['Theft Over $500','Theft Under $500']);


              x.domain(dataArray);
              y.domain([0, 100000]);

              svg.append("g")
                  .attr("class", "x axis")
                  .attr("transform", "translate(0," + height + ")")
                  .call(xAxis);

              svg.append("g")
                  .attr("class", "y axis")
                  .call(yAxis)
                  .append("text")
                  .attr("transform", "rotate(-90)")
                  .attr("y", 6)
                  .attr("dy", ".71em")
                  .style("text-anchor", "end")
                  .text("Theft Cases");

              var year = svg.selectAll(".year")
                  .data(newData)
                  .enter().append("g")
                  .attr("class", "g")
                  .attr("transform", function(d, i) { return "translate(" + x(d.year) + ",0)"; });

              year.selectAll("rect")
                  .data(function(d) { return d.types;})
                  .enter().append("rect")
                  .attr("width", x.rangeBand())
                  .attr("y", function(d, i) { return y(d.y);})
                  .attr("height", function(d, i) { return (y(d.height));})
                  .style("fill", function(d, i) { return color(i); });

              var legend = svg.selectAll(".legend")
                  .data(['Theft Over $500','Theft Under $500'])
                  .enter().append("g")
                  .attr("class", "legend")
                  .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

              legend.append("rect")
                  .attr("x", width - 18)
                  .attr("width", 18)
                  .attr("height", 18)
                  .style("fill", color);

              legend.append("text")
                  .attr("x", width - 24)
                  .attr("y", 9)
                  .attr("dy", ".35em")
                  .style("text-anchor", "end")
                  .text(function(d) { return d; });

        });
    </script>
</body>
</html>
